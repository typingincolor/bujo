# Bujo Companion Integration Specification

**Version:** 1.0
**Database Schema Version:** 1.1
**Last Updated:** 2026-01-26
**Code Examples:** Go (golang)

## Overview

This specification describes how to integrate Claude-generated insights from `claude-insights.db` into the main bujo application. The insights database is a read-only data source that provides summarized views, extracted metadata, and strategic intelligence derived from journal entries.

## Date Conventions

**Week Boundaries:**
- **Week Start:** Always a Monday (YYYY-MM-DD format)
- **Week End:** Always a Sunday (YYYY-MM-DD format)
- **Week Definition:** ISO-8601 standard (Monday-Sunday)

All weekly summaries use consistent week boundaries. For example:
- Week of Jan 13-19, 2026: `week_start = '2026-01-13'`, `week_end = '2026-01-19'`
- Week of Jan 20-26, 2026: `week_start = '2026-01-20'`, `week_end = '2026-01-26'`

**Date Format:** All date fields use `YYYY-MM-DD` format (SQLite TEXT type).

**Important:** When querying by week, always use `week_start` as the primary key. The current week's summary may not exist until the user generates it (typically on Monday mornings).

## Database Access

**Location:** `~/bujo-companion/claude-insights.db`
**Format:** SQLite 3
**Access Mode:** Read-only
**Creation:** Auto-created on first save by Claude Code plugin
**Updates:** Updated when user invokes Claude skills (async, unpredictable timing)

### Recommended Access Pattern

```go
import (
    "database/sql"
    "os"
    "path/filepath"
    _ "github.com/mattn/go-sqlite3"
)

func openInsightsDB() (*sql.DB, error) {
    homeDir, err := os.UserHomeDir()
    if err != nil {
        return nil, err
    }

    dbPath := filepath.Join(homeDir, "bujo-companion", "claude-insights.db")

    // Check if database exists
    if _, err := os.Stat(dbPath); os.IsNotExist(err) {
        // Gracefully handle missing insights database
        return nil, nil
    }

    // Open read-only connection
    db, err := sql.Open("sqlite3", "file:"+dbPath+"?mode=ro")
    if err != nil {
        return nil, err
    }

    return db, nil
}
```

### Week Boundary Helper

Utility function to calculate current week boundaries:

```go
import (
    "time"
)

type WeekBoundaries struct {
    WeekStart string // YYYY-MM-DD
    WeekEnd   string // YYYY-MM-DD
}

func GetCurrentWeekBoundaries() WeekBoundaries {
    today := time.Now()

    // Calculate Monday (week start)
    // time.Monday = 1, time.Sunday = 0
    dayOfWeek := int(today.Weekday())
    daysFromMonday := dayOfWeek - 1
    if dayOfWeek == 0 { // Sunday
        daysFromMonday = 6
    }

    monday := today.AddDate(0, 0, -daysFromMonday)
    sunday := monday.AddDate(0, 0, 6)

    // Format as YYYY-MM-DD
    return WeekBoundaries{
        WeekStart: monday.Format("2006-01-02"),
        WeekEnd:   sunday.Format("2006-01-02"),
    }
}

// Example usage:
// week := GetCurrentWeekBoundaries()
// row := db.QueryRow("SELECT * FROM summaries WHERE week_start = ?", week.WeekStart)
```

## Data Model

### Entity Relationship Diagram

```
┌──────────────┐
│  summaries   │◄──────┐
│  (weekly)    │       │
└──────┬───────┘       │
       │               │
       │ 1:N           │ N:1
       │               │
       ├───────────────┴────────┐
       │                        │
       ▼                        │
┌──────────────┐         ┌──────────────┐
│    topics    │         │   actions    │
└──────────────┘         └──────────────┘
       │                        │
       │                        │
       ▼                        ▼
┌──────────────────────────────────────┐
│     initiative_mentions              │
└──────┬───────────────────────────────┘
       │ N:1
       │
       ▼
┌──────────────┐       ┌──────────────────┐
│ initiatives  │◄──────│    decisions     │
│              │  N:M  │                  │
└──────────────┘       └──────────────────┘
                       (via decision_initiatives)
```

### Schema Reference

#### summaries
Weekly narrative summaries generated by Claude.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| week_start | TEXT | NOT NULL | Monday date (YYYY-MM-DD) |
| week_end | TEXT | NOT NULL | Sunday date (YYYY-MM-DD) |
| summary_text | TEXT | NOT NULL | Full markdown summary (max ~2400 chars) |
| created_at | TEXT | DEFAULT CURRENT_TIMESTAMP | When summary was generated |

**Indexes:** Consider adding `CREATE INDEX idx_summaries_week ON summaries(week_start DESC)`

---

#### topics
Keywords and themes extracted from summaries.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| summary_id | INTEGER | NOT NULL, FK | References summaries.id |
| topic | TEXT | NOT NULL | Topic name (e.g., "GenAI") |
| content | TEXT | | Relevant snippet/context |
| importance | TEXT | CHECK: high/medium/low | Significance level |

**Common Topics:** GenAI, ThoughtWorks, Tech Scorecard, Agile@Booking, BHFS, Tech Standards

---

#### initiatives
Programs and projects being tracked over time.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| name | TEXT | NOT NULL, UNIQUE | Initiative name |
| status | TEXT | CHECK: active/planning/blocked/completed/on-hold | Current state |
| description | TEXT | | Initiative description |
| last_updated | TEXT | DEFAULT CURRENT_TIMESTAMP | Last modification time |

**Status Flow:** `planning` → `active` → `completed` or `blocked`/`on-hold`

---

#### initiative_mentions
Links summaries to initiatives with weekly updates.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| summary_id | INTEGER | NOT NULL, FK | References summaries.id |
| initiative_id | INTEGER | NOT NULL, FK | References initiatives.id |
| update_text | TEXT | | What happened this week |

---

#### actions
Action items extracted from summaries.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| summary_id | INTEGER | NOT NULL, FK | References summaries.id |
| action_text | TEXT | NOT NULL | Description of action |
| priority | TEXT | CHECK: high/medium/low | Urgency level |
| status | TEXT | CHECK: pending/completed/blocked/cancelled | Current state |
| due_date | TEXT | | Optional due date (YYYY-MM-DD) |
| created_at | TEXT | DEFAULT CURRENT_TIMESTAMP | When action was created |

---

#### decisions
Important decisions with context and expected outcomes.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| decision_text | TEXT | NOT NULL | The decision made |
| rationale | TEXT | | Why this decision was made |
| participants | TEXT | | Who was involved (comma-separated) |
| expected_outcomes | TEXT | | What we expect to happen |
| decision_date | TEXT | NOT NULL | When decided (YYYY-MM-DD) |
| summary_id | INTEGER | FK (nullable) | References summaries.id (NULL if manually logged) |
| created_at | TEXT | DEFAULT CURRENT_TIMESTAMP | When record was created |

---

#### decision_initiatives
Many-to-many link between decisions and initiatives.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| id | INTEGER | PRIMARY KEY | Unique identifier |
| decision_id | INTEGER | NOT NULL, FK | References decisions.id |
| initiative_id | INTEGER | NOT NULL, FK | References initiatives.id |

---

#### metadata
Database versioning and metadata.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| key | TEXT | PRIMARY KEY | Metadata key |
| value | TEXT | | Metadata value |

**Standard Keys:**
- `version`: Schema version (current: "1.1")
- `created_at`: Database creation timestamp

## Integration Use Cases

### 1. Weekly Summary Dashboard

**Goal:** Show recent weekly summaries with quick navigation.

```sql
SELECT
  id,
  week_start,
  week_end,
  summary_text,
  created_at
FROM summaries
ORDER BY week_start DESC
LIMIT 10;
```

**UI Suggestion:**
- Card-based layout with week range as title
- Truncated summary with "Read more" expansion
- Filter by date range

---

### 2. Topic Timeline View

**Goal:** Show all activity related to a specific topic across weeks.

```sql
-- Get topic mentions across time
SELECT
  t.topic,
  t.content,
  t.importance,
  s.week_start,
  s.week_end,
  s.summary_text
FROM topics t
JOIN summaries s ON t.summary_id = s.id
WHERE t.topic = ?
ORDER BY s.week_start DESC;

-- Get all unique topics (for autocomplete/filter)
SELECT DISTINCT topic
FROM topics
ORDER BY topic;
```

**UI Suggestion:**
- Timeline/feed view showing chronological mentions
- Topic filter dropdown with search
- Importance badges (high/medium/low)

---

### 3. Initiative Portfolio View

**Goal:** Strategic overview of all programs with status and activity.

```sql
-- Get initiatives with mention frequency
SELECT
  i.id,
  i.name,
  i.status,
  i.description,
  i.last_updated,
  COUNT(im.id) as mention_count,
  MAX(s.week_start) as last_mentioned_week,
  GROUP_CONCAT(DISTINCT s.week_start) as activity_weeks
FROM initiatives i
LEFT JOIN initiative_mentions im ON i.id = im.initiative_id
LEFT JOIN summaries s ON im.summary_id = s.id
GROUP BY i.id
ORDER BY
  CASE i.status
    WHEN 'active' THEN 1
    WHEN 'planning' THEN 2
    WHEN 'blocked' THEN 3
    WHEN 'on-hold' THEN 4
    WHEN 'completed' THEN 5
  END,
  mention_count DESC;
```

**UI Suggestion:**
- Kanban-style board grouped by status
- Activity indicator (mentions last 4 weeks)
- Click to see detailed timeline

---

### 4. Initiative Detail View

**Goal:** Deep dive into single initiative with all updates.

```sql
-- Get initiative updates chronologically
SELECT
  s.week_start,
  s.week_end,
  im.update_text,
  s.summary_text
FROM initiative_mentions im
JOIN summaries s ON im.summary_id = s.id
WHERE im.initiative_id = ?
ORDER BY s.week_start DESC;

-- Get related actions
SELECT
  a.action_text,
  a.priority,
  a.status,
  a.due_date,
  s.week_start
FROM actions a
JOIN summaries s ON a.summary_id = s.id
WHERE s.id IN (
  SELECT summary_id
  FROM initiative_mentions
  WHERE initiative_id = ?
)
AND a.status = 'pending'
ORDER BY a.priority DESC, a.due_date ASC;

-- Get related decisions
SELECT
  d.decision_text,
  d.rationale,
  d.participants,
  d.expected_outcomes,
  d.decision_date
FROM decisions d
JOIN decision_initiatives di ON d.id = di.decision_id
WHERE di.initiative_id = ?
ORDER BY d.decision_date DESC;
```

**UI Suggestion:**
- Timeline of weekly updates
- Separate sections for pending actions and decisions
- Link back to full weekly summary

---

### 5. Action Items Widget

**Goal:** Show pending actions with priority and context.

```sql
-- Get all pending actions with context
SELECT
  a.id,
  a.action_text,
  a.priority,
  a.status,
  a.due_date,
  s.week_start,
  s.week_end
FROM actions a
JOIN summaries s ON a.summary_id = s.id
WHERE a.status = 'pending'
ORDER BY
  CASE a.priority
    WHEN 'high' THEN 1
    WHEN 'medium' THEN 2
    WHEN 'low' THEN 3
  END,
  a.due_date ASC NULLS LAST,
  s.week_start DESC;

-- Get action count by priority
SELECT
  priority,
  COUNT(*) as count
FROM actions
WHERE status = 'pending'
GROUP BY priority;
```

**UI Suggestion:**
- Compact list with priority badges
- Due date highlighting (overdue/upcoming)
- Quick action buttons (mark complete, snooze)
- Note: These are strategic-level actions, not the same as daily tasks

---

### 6. Decision Log

**Goal:** Searchable history of important decisions.

```sql
-- Get decisions with initiatives
SELECT
  d.id,
  d.decision_text,
  d.rationale,
  d.participants,
  d.expected_outcomes,
  d.decision_date,
  d.summary_id,
  GROUP_CONCAT(i.name) as initiatives
FROM decisions d
LEFT JOIN decision_initiatives di ON d.id = di.decision_id
LEFT JOIN initiatives i ON di.initiative_id = i.id
GROUP BY d.id
ORDER BY d.decision_date DESC;

-- Filter decisions by date range
WHERE d.decision_date BETWEEN ? AND ?

-- Filter decisions by initiative
WHERE d.id IN (
  SELECT decision_id
  FROM decision_initiatives
  WHERE initiative_id = ?
)

-- Search decisions by text
WHERE d.decision_text LIKE '%' || ? || '%'
   OR d.rationale LIKE '%' || ? || '%'
```

**UI Suggestion:**
- Chronological list with search/filter
- Show decision date and participants
- Expandable details (rationale, outcomes)
- Tags for related initiatives

---

### 7. Insights Dashboard (Executive Summary)

**Goal:** High-level view of what's happening now.

```sql
-- Recent summary (last week)
SELECT summary_text
FROM summaries
ORDER BY week_start DESC
LIMIT 1;

-- Top active initiatives (most mentions last 4 weeks)
SELECT
  i.name,
  i.status,
  COUNT(im.id) as recent_mentions
FROM initiatives i
JOIN initiative_mentions im ON i.id = im.initiative_id
JOIN summaries s ON im.summary_id = s.id
WHERE s.week_start >= date('now', '-28 days')
  AND i.status = 'active'
GROUP BY i.id
ORDER BY recent_mentions DESC
LIMIT 5;

-- High priority pending actions
SELECT
  action_text,
  due_date
FROM actions
WHERE status = 'pending'
  AND priority = 'high'
ORDER BY due_date ASC NULLS LAST
LIMIT 5;

-- Recent important decisions (last 30 days)
SELECT
  decision_text,
  decision_date
FROM decisions
WHERE decision_date >= date('now', '-30 days')
ORDER BY decision_date DESC
LIMIT 3;
```

**UI Suggestion:**
- Dashboard cards for each section
- "What's Hot" initiatives visualization
- Action items requiring attention
- Recent decisions snapshot

---

### 8. Weekly Report Generator

**Goal:** Export/print weekly summary with all context.

```sql
-- Get complete week data
SELECT
  s.*,
  (SELECT GROUP_CONCAT(topic || ' (' || importance || ')', ', ')
   FROM topics WHERE summary_id = s.id) as topics,
  (SELECT COUNT(*)
   FROM actions WHERE summary_id = s.id AND status = 'pending') as pending_actions,
  (SELECT COUNT(*)
   FROM initiative_mentions WHERE summary_id = s.id) as initiatives_mentioned
FROM summaries s
WHERE week_start = ?;

-- Get topics for week
SELECT topic, importance, content
FROM topics
WHERE summary_id = ?
ORDER BY
  CASE importance
    WHEN 'high' THEN 1
    WHEN 'medium' THEN 2
    WHEN 'low' THEN 3
  END;

-- Get initiative updates for week
SELECT i.name, im.update_text
FROM initiative_mentions im
JOIN initiatives i ON im.initiative_id = i.id
WHERE im.summary_id = ?
ORDER BY i.name;
```

**UI Suggestion:**
- Print-friendly layout
- Include all sections: summary, topics, initiatives, actions
- Export as PDF/Markdown

## Data Freshness & Sync

### Update Timing
- Database updated when user runs Claude skills:
  - "save this week's summary" → adds summary + topics + initiatives + actions
  - "log decision" → adds decision record
- No predictable schedule; updates are user-driven
- Typical frequency: Weekly (Monday mornings)

### Stale Data Handling
```sql
-- Check when last summary was generated
SELECT MAX(week_start) as last_summary_week
FROM summaries;

-- Check if current week has a summary (week_start is always Monday)
SELECT COUNT(*) as has_current_week
FROM summaries
WHERE week_start = date('now', 'weekday 1', '-7 days'); -- Get this week's Monday

-- Calculate days since last summary
SELECT julianday('now') - julianday(MAX(week_start)) as days_since_last_summary
FROM summaries;

-- Check database version
SELECT value FROM metadata WHERE key = 'version';
```

**UI Suggestion:**
- Show "Last updated: X days ago" indicator
- Prompt user to generate summary if none exists for current week (Monday-Sunday)
- Display which week the latest summary covers (e.g., "Last summary: Jan 13-19")
- Handle empty database gracefully (first-time setup)
- Note: Summaries are typically generated on Monday mornings, so current week may be empty until user generates it

## Error Handling

### Database Not Found
```go
type InsightsStatus struct {
    Status  string
    Message string
}

func checkInsightsDatabase() (*InsightsStatus, error) {
    homeDir, err := os.UserHomeDir()
    if err != nil {
        return nil, err
    }

    dbPath := filepath.Join(homeDir, "bujo-companion", "claude-insights.db")

    if _, err := os.Stat(dbPath); os.IsNotExist(err) {
        // Show onboarding UI explaining Claude integration
        return &InsightsStatus{
            Status:  "not_initialized",
            Message: "Claude insights not yet available. Generate your first weekly summary to begin.",
        }, nil
    }

    return &InsightsStatus{
        Status: "ready",
    }, nil
}
```

### Schema Version Mismatch
```sql
SELECT value FROM metadata WHERE key = 'version';
```

Expected version: `1.1`

If version < 1.1:
- Decisions table may not exist
- Gracefully degrade functionality
- Show migration prompt

### Empty Database
```sql
SELECT COUNT(*) FROM summaries;
```

If count = 0:
- Show empty state UI
- Provide instructions to generate first summary
- Link to Claude Code documentation

## Performance Considerations

### Query Optimization
- Most queries are small (<1000 rows)
- Consider caching results for 5-10 minutes
- Use prepared statements for repeated queries
- Add indexes if queries feel slow:
  ```sql
  CREATE INDEX idx_summaries_week ON summaries(week_start DESC);
  CREATE INDEX idx_topics_summary ON topics(summary_id);
  CREATE INDEX idx_actions_status ON actions(status, priority);
  CREATE INDEX idx_initiative_mentions_summary ON initiative_mentions(summary_id);
  CREATE INDEX idx_initiative_mentions_initiative ON initiative_mentions(initiative_id);
  CREATE INDEX idx_decisions_date ON decisions(decision_date DESC);
  ```

### Read-Only Access
- Open with `SQLITE_OPEN_READONLY` flag
- Multiple read connections are safe (SQLite supports concurrent reads)
- No locking concerns since no writes from app

## UI/UX Recommendations

### Navigation Structure
```
Main Navigation
├── Journal (existing bujo views)
├── Insights (new)
│   ├── Dashboard (executive summary)
│   ├── Summaries (weekly archive)
│   ├── Initiatives (portfolio view)
│   ├── Topics (theme explorer)
│   ├── Actions (strategic todos)
│   └── Decisions (decision log)
└── Settings
```

### Feature Flags
Consider adding feature flag for insights integration:
```go
func isInsightsEnabled() bool {
    status, err := checkInsightsDatabase()
    if err != nil || status == nil {
        return false
    }
    return status.Status == "ready"
}

// Usage in handlers:
// if isInsightsEnabled() {
//     // Render insights UI
// } else {
//     // Show onboarding or hide insights features
// }
```

This allows graceful degradation if database doesn't exist.

### First-Time User Experience
1. Check if `claude-insights.db` exists
2. If not, show onboarding:
   - "Unlock AI-powered insights"
   - Link to Claude Code setup instructions
   - Screenshot/demo of insights features
3. If exists but empty:
   - "Generate your first weekly summary to see insights here"
   - Show example/template of what insights look like

## Future Considerations

### Potential Schema Evolution
Watch for these possible future additions:
- **goals** table: Link summaries to monthly goals
- **metrics** table: Quantitative KPIs over time
- **relationships** table: People/team connections
- **attachments** table: Links to external resources

### Bi-directional Integration Ideas
While current spec is read-only, future versions could:
- Mark insights actions as "done" → sync back to Claude
- Flag summaries for regeneration
- Request topic deep-dives on demand
- Link insights actions to daily tasks in main bujo database

### API Design (Optional)
If building API layer:
```go
type SummariesOptions struct {
    Limit     int
    StartDate string
}

type InitiativesOptions struct {
    Status []string
}

type TopicsOptions struct {
    Topic string
}

type ActionsOptions struct {
    Status   string
    Priority string
}

type DecisionsOptions struct {
    StartDate    string
    InitiativeID *int
}

type InsightsAPI interface {
    GetSummaries(ctx context.Context, opts SummariesOptions) ([]Summary, error)
    GetInitiatives(ctx context.Context, opts InitiativesOptions) ([]Initiative, error)
    GetTopics(ctx context.Context, opts TopicsOptions) ([]Topic, error)
    GetActions(ctx context.Context, opts ActionsOptions) ([]Action, error)
    GetDecisions(ctx context.Context, opts DecisionsOptions) ([]Decision, error)
    GetInsightsDashboard(ctx context.Context) (*Dashboard, error)
}

// Example model structs:
type Summary struct {
    ID          int
    WeekStart   string
    WeekEnd     string
    SummaryText string
    CreatedAt   string
}

type Initiative struct {
    ID          int
    Name        string
    Status      string
    Description string
    LastUpdated string
}
```


## Testing Recommendations

### Test Data
Use the included test database for development:
```bash
cp ~/bujo-companion/claude-insights.db ~/bujo-companion/claude-insights.test.db
```

### Test Scenarios
1. **Empty database** - First-time user
2. **Single summary** - Minimal data
3. **Multiple weeks** - Time-series views
4. **Large dataset** - 52+ weeks (performance testing)
5. **Missing database** - Error handling
6. **Old schema version** - Migration handling

### Validation Queries
```sql
-- Verify referential integrity
SELECT COUNT(*) FROM topics WHERE summary_id NOT IN (SELECT id FROM summaries);
-- Should return 0

-- Check for orphaned actions
SELECT COUNT(*) FROM actions WHERE summary_id NOT IN (SELECT id FROM summaries);
-- Should return 0

-- Verify date formats
SELECT * FROM summaries WHERE week_start NOT LIKE '____-__-__';
-- Should return 0 rows
```

## Contact & Support

**Plugin Location:** `~/bujo-companion/.claude/plugins/bujo-summaries/`
**Version:** 1.3.0
**Documentation:** See `CLAUDE.md` in project root

For questions about:
- **Schema changes:** Check migration scripts in `scripts/migrate-*.sh`
- **Data generation:** See skill definitions in `skills/*/SKILL.md`
- **Claude Code:** https://docs.anthropic.com/claude/docs/claude-code

---

## Appendix: Complete SQL Schema

```sql
-- Current schema version: 1.1

CREATE TABLE summaries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    week_start TEXT NOT NULL,
    week_end TEXT NOT NULL,
    summary_text TEXT NOT NULL,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE topics (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    summary_id INTEGER NOT NULL,
    topic TEXT NOT NULL,
    content TEXT,
    importance TEXT CHECK(importance IN ('high', 'medium', 'low')),
    FOREIGN KEY (summary_id) REFERENCES summaries(id)
);

CREATE TABLE initiatives (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE,
    status TEXT CHECK(status IN ('active', 'planning', 'blocked', 'completed', 'on-hold')),
    description TEXT,
    last_updated TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE initiative_mentions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    summary_id INTEGER NOT NULL,
    initiative_id INTEGER NOT NULL,
    update_text TEXT,
    FOREIGN KEY (summary_id) REFERENCES summaries(id),
    FOREIGN KEY (initiative_id) REFERENCES initiatives(id)
);

CREATE TABLE actions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    summary_id INTEGER NOT NULL,
    action_text TEXT NOT NULL,
    priority TEXT CHECK(priority IN ('high', 'medium', 'low')),
    status TEXT CHECK(status IN ('pending', 'completed', 'blocked', 'cancelled')),
    due_date TEXT,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (summary_id) REFERENCES summaries(id)
);

CREATE TABLE decisions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    decision_text TEXT NOT NULL,
    rationale TEXT,
    participants TEXT,
    expected_outcomes TEXT,
    decision_date TEXT NOT NULL,
    summary_id INTEGER,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (summary_id) REFERENCES summaries(id)
);

CREATE TABLE decision_initiatives (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    decision_id INTEGER NOT NULL,
    initiative_id INTEGER NOT NULL,
    FOREIGN KEY (decision_id) REFERENCES decisions(id),
    FOREIGN KEY (initiative_id) REFERENCES initiatives(id)
);

CREATE TABLE metadata (
    key TEXT PRIMARY KEY,
    value TEXT
);

-- Insert version info
INSERT INTO metadata (key, value) VALUES ('version', '1.1');
INSERT INTO metadata (key, value) VALUES ('created_at', datetime('now'));
```
